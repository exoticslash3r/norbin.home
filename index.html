<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>N0rb1n</title>
  <style>
    body { margin:0; font-family: monospace; background-color:#0a0a0a; color:#fff; overflow-x:hidden; }
    header { display:flex; align-items:center; justify-content:space-between; padding:10px 20px; background:#111; box-shadow:0 2px 5px rgba(0,0,0,0.5); position:fixed; top:0; left:0; right:0; z-index:1000; }
    header h1 { color:red; text-shadow:0 0 10px red; margin:0; font-size:20px; }
    #onlineCount { font-size:14px; margin-left:8px; color:#0f0; }
    .menu-btn { cursor:pointer; padding:8px 14px; background:#222; border-radius:6px; }
    nav { position:fixed; top:50px; left:0; width:100%; background:#151515; max-height:0; overflow:hidden; transition:max-height 0.5s ease-in-out; display:flex; flex-direction:column; }
    nav.open { max-height:500px; }
    nav a { padding:15px; border-bottom:1px solid #222; color:#fff; text-decoration:none; display:block; }
    nav a:hover { background:#222; }
    main { padding:80px 20px; }
    .hidden { display:none; }
    .section { margin-top:20px; }
    input, textarea, button, select { background:#111; color:#fff; border:1px solid #333; padding:8px; margin:5px 0; width:100%; }
    button { cursor:pointer; }
    .pastes, .friends, .chat-box { border:1px solid #333; padding:10px; margin:10px 0; max-height:200px; overflow-y:auto; }
    #previewContent { border:1px solid #333; padding:15px; max-height:60vh; overflow-y:auto; white-space:pre-wrap; background:#111; }
    #previewImage { max-width:100%; margin-top:10px; display:block; }
  </style>
</head>
<body>
  <header>
    <h1>N0rb1n <span id="onlineCount">● 1</span></h1>
    <div class="menu-btn" onclick="toggleMenu()">☰ Menu</div>
  </header>
  <nav id="menu">
    <a href="#home" onclick="showSection('home')">Home</a>
    <a href="#paste" onclick="showSection('paste')">Paste</a>
    <a href="#signin" id="signinLink" onclick="showSection('signin')">Sign In</a>
    <a href="#login" id="loginLink" onclick="showSection('login')">Log In</a>
    <a href="#account" id="accountLink" class="hidden" onclick="showSection('account')">My Account</a>
    <a href="#hall" onclick="showSection('hall')">Hall of Autism</a>
  </nav>
  <main>
    <div id="home" class="section"> 
      <h2>Home</h2>
      <input type="text" id="searchInput" placeholder="Search pastes by title" oninput="searchPastes()">
      <div id="recentPastes"></div>
      <div id="searchResults"></div>
    </div>

    <div id="paste" class="section hidden">
      <h2>Create Paste</h2>
      <input type="text" id="pasteTitle" placeholder="Title">
      <textarea id="pasteContent" rows="6" placeholder="Your paste..."></textarea>
      <input type="file" id="pasteImage">
      <input type="text" id="pasteImageUrl" placeholder="Image URL">
      <button onclick="publishPaste()">Publish</button>
      <button onclick="clearPasteForm()">Clear</button>
      <p id="pasteAlert"></p>
    </div>

    <div id="preview" class="section hidden">
      <h2 id="previewTitle"></h2>
      <div id="previewContent"></div>
      <img id="previewImage" class="hidden">
      <button onclick="showSection('home')">← Back</button>
    </div>

    <div id="hall" class="section hidden">
      <h2>Hall of Autism</h2>
      <div id="hallContent"></div>
    </div>

    <div id="signin" class="section hidden">
      <h2>Sign In</h2>
      <input type="text" id="signinUser" placeholder="Username">
      <input type="password" id="signinPass" placeholder="Password">
      <button onclick="signIn()">Sign In</button>
      <p id="signinAlert"></p>
    </div>

    <div id="login" class="section hidden">
      <h2>Log In</h2>
      <input type="text" id="loginUser" placeholder="Username">
      <input type="password" id="loginPass" placeholder="Password">
      <button onclick="logIn()">Log In</button>
      <p id="loginAlert"></p>
    </div>

    <div id="account" class="section hidden">
      <h2>My Account</h2>
      <p id="welcome"></p>
      <input type="file" id="profileImage">
      <input type="text" id="profileImageUrl" placeholder="Profile image URL">
      <button onclick="setProfileImage()">Set Profile</button>
      <button onclick="logOut()">Log Out</button>
      <h3>Friends</h3>
      <input type="text" id="friendName" placeholder="Friend username">
      <button onclick="addFriend()">Add Friend</button>
      <div id="friendRequests"></div>
      <div id="friendList"></div>
      <div id="chatBox" class="chat-box hidden">
        <h3>Chat</h3>
        <div id="chatMessages"></div>
        <input type="text" id="chatInput" placeholder="Type a message">
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </main>
  <script>
    let menu=document.getElementById('menu');
    function toggleMenu(){menu.classList.toggle('open');}

    function showSection(id){
      document.querySelectorAll('.section').forEach(s=>s.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      if(id==='home'){renderRecentPastes();}
    }

    function getDevice(){let ua=navigator.userAgent; if(/android/i.test(ua)) return 'Android'; if(/iPhone|iPad|iPod/i.test(ua)) return 'iOS'; if(/Windows|Mac|Linux/i.test(ua)) return 'Desktop'; return 'VM';}
    document.body.insertAdjacentHTML('beforeend', `<p style="padding:10px;">Device: ${getDevice()}</p>`);

    let pastes=JSON.parse(localStorage.getItem('pastes')||'[]');
    function renderRecentPastes(){
      let c=document.getElementById('recentPastes');
      c.innerHTML='<h3>Recent Pastes</h3>';
      pastes.slice(-5).reverse().forEach((p)=>{ 
        c.innerHTML+=`<div><b>${p.title}</b> <button onclick="previewPaste(${p.id})">Preview</button></div>`;
      });
    }

    function searchPastes(){
      let q=document.getElementById('searchInput').value.toLowerCase();
      let res=document.getElementById('searchResults');
      let rec=document.getElementById('recentPastes');
      if(!q){rec.style.display='block';res.innerHTML='';return;}
      rec.style.display='none';
      let matches=pastes.filter(p=>p.title.toLowerCase().includes(q));
      res.innerHTML=matches.map(p=>`<div><b>${p.title}</b> <button onclick="previewPaste(${p.id})">Preview</button></div>`).join('');
    }

    function previewPaste(id){
      let p=pastes.find(pp=>pp.id===id);
      if(!p) return;
      document.getElementById('previewTitle').innerText=p.title;
      document.getElementById('previewContent').innerText=p.content;
      if(p.img){
        document.getElementById('previewImage').src=p.img;
        document.getElementById('previewImage').classList.remove('hidden');
      } else {
        document.getElementById('previewImage').classList.add('hidden');
      }
      showSection('preview');
    }

    function publishPaste(){
      let t=document.getElementById('pasteTitle').value;
      let c=document.getElementById('pasteContent').value;
      let imgFile=document.getElementById('pasteImage').files[0];
      let imgUrl=document.getElementById('pasteImageUrl').value;
      let img='';
      if(imgFile){img=URL.createObjectURL(imgFile);}
      else if(imgUrl){img=imgUrl;}
      if(!t||!c){alert('Title and content required');return;}
      let paste={id:Date.now(),title:t,content:c,img:img};
      pastes.push(paste);
      localStorage.setItem('pastes',JSON.stringify(pastes));
      document.getElementById('pasteAlert').innerText='Paste created!';
      renderHall();
      renderRecentPastes();
    }

    function clearPasteForm(){
      document.getElementById('pasteTitle').value='';
      document.getElementById('pasteContent').value='';
      document.getElementById('pasteImage').value='';
      document.getElementById('pasteImageUrl').value='';
      document.getElementById('pasteAlert').innerText='';
    }

    function renderHall(){
      let hall=document.getElementById('hallContent');
      hall.innerHTML='';
      let grouped={};
      pastes.forEach(p=>{grouped[p.title]=grouped[p.title]||[];grouped[p.title].push(p);});
      Object.keys(grouped).forEach(t=>{
        if(grouped[t].length>=3){
          let img=grouped[t][0].img||'';
          hall.innerHTML+=`<div><b>${t}</b><br>${img?`<img src="${img}" width="100">`:''}</div>`;
        }
      });
    }
    renderHall();

    let users=JSON.parse(localStorage.getItem('users')||'{}');let currentUser=null;
    function signIn(){
      let u=document.getElementById('signinUser').value;
      let p=document.getElementById('signinPass').value;
      if(users[u]){document.getElementById('signinAlert').innerText='Account already exists';return;}
      users[u]={password:p,friends:[],requests:[]};
      localStorage.setItem('users',JSON.stringify(users));
      document.getElementById('signinAlert').innerText='Account created!';
    }
    function logIn(){
      let u=document.getElementById('loginUser').value;
      let p=document.getElementById('loginPass').value;
      if(!users[u]){document.getElementById('loginAlert').innerText='Account doesn\'t exist';return;}
      if(users[u].password!==p){document.getElementById('loginAlert').innerText='Password incorrect';return;}
      currentUser=u;
      document.getElementById('loginAlert').innerText='Logged in!';
      document.getElementById('signinLink').classList.add('hidden');
      document.getElementById('loginLink').classList.add('hidden');
      document.getElementById('accountLink').classList.remove('hidden');
      document.getElementById('welcome').innerText='Welcome, '+u;
      showSection('account');
      renderFriends();
    }
    function logOut(){
      currentUser=null;
      document.getElementById('signinLink').classList.remove('hidden');
      document.getElementById('loginLink').classList.remove('hidden');
      document.getElementById('accountLink').classList.add('hidden');
      showSection('home');
    }

    function setProfileImage(){alert('Profile image set! (preview only)');}

    function addFriend(){
      let f=document.getElementById('friendName').value;
      if(!users[f]){alert('User not found');return;}
      users[f].requests.push(currentUser);
      localStorage.setItem('users',JSON.stringify(users));
      alert('Friend request sent!');
    }
    function renderFriends(){
      let req=document.getElementById('friendRequests');
      req.innerHTML='<h4>Friend Requests</h4>';
      users[currentUser].requests.forEach(r=>{
        req.innerHTML+=`<div>${r} <button onclick="acceptFriend('${r}')">Accept</button> <button onclick="denyFriend('${r}')">Deny</button></div>`;
      });
      let fl=document.getElementById('friendList');
      fl.innerHTML='<h4>Friends</h4>';
      users[currentUser].friends.forEach(f=>{
        fl.innerHTML+=`<div>${f} <button onclick="openChat('${f}')">Chat Now!</button></div>`;
      });
    }
    function acceptFriend(f){
      users[currentUser].friends.push(f);
      users[f].friends.push(currentUser);
      users[currentUser].requests=users[currentUser].requests.filter(r=>r!==f);
      localStorage.setItem('users',JSON.stringify(users));
      renderFriends();
    }
    function denyFriend(f){
      users[currentUser].requests=users[currentUser].requests.filter(r=>r!==f);
      localStorage.setItem('users',JSON.stringify(users));
      renderFriends();
    }

    let chatTarget=null;
    function openChat(f){
      chatTarget=f;
      document.getElementById('chatBox').classList.remove('hidden');
      renderChat();
    }
    function renderChat(){
      let box=document.getElementById('chatMessages');
      box.innerHTML='';
      let msgs=JSON.parse(localStorage.getItem('chat_'+currentUser+'_'+chatTarget)||'[]');
      msgs.forEach(m=>{
        box.innerHTML+=`<div><b>${m.sender}:</b> ${m.text}</div>`;
      });
    }
    function sendMessage(){
      let inp=document.getElementById('chatInput');
      let text=inp.value;
      inp.value='';
      let msgs=JSON.parse(localStorage.getItem('chat_'+currentUser+'_'+chatTarget)||'[]');
      msgs.push({sender:currentUser,text:text});
      localStorage.setItem('chat_'+currentUser+'_'+chatTarget,JSON.stringify(msgs));
      localStorage.setItem('chat_'+chatTarget+'_'+currentUser,JSON.stringify(msgs));
      renderChat();
    }

    renderRecentPastes();
  </script>
</body>
</html>
